name: "Build image and push it with a myriad of tags"
description: "does what it says in the name"

inputs:
  stages:
    description: list of stages
    required: true
  apps:
    description: list of apps
    required: true

runs:
  using: composite
  steps:
    - name: foo
      run: |
        echo '{"stages": ${{ inputs.stages }}, "apps": ${{ inputs.apps }} }' \
        # build the cartesian product of all stages and all apps \
        | jq '[.stages[] as $stages | .apps[] as $apps | {stage: $stages, app: $apps}]' \
        # build the image tag names with a compact output \
        jq -c 'map("api.setops.co/zweitag/veritrustid/" + .["env"] + "/" + .["app"] + ":latest")'
      shell: bash
